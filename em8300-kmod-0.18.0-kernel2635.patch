diff -up em8300-0.18.0/include/linux/em8300.h~ em8300-0.18.0/include/linux/em8300.h
--- em8300-0.18.0/include/linux/em8300.h~	2009-12-21 00:24:55.000000000 +0200
+++ em8300-0.18.0/include/linux/em8300.h	2011-01-23 22:39:34.938179632 +0200
@@ -234,6 +234,10 @@ extern int major;
 #include <linux/wait.h> /* wait_queue_head_t */
 #include <linux/list.h> /* struct list_head */
 
+#if LINUX_VERSION_CODE >= KERNEL_VERSION(2,6,34)
+#include <linux/semaphore.h> /* struct semaphore */
+#endif
+
 #if defined(CONFIG_SND) || defined(CONFIG_SND_MODULE)
 #if LINUX_VERSION_CODE >= KERNEL_VERSION(2,6,16)
 #define snd_card_t struct snd_card
